<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>MockHTTPinC</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">MockHTTPinC</h1>
        <p class="header">An easy to use C library to test HTTP(S) client code.</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/lgov/MockHTTPinC/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/lgov/MockHTTPinC/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/lgov/MockHTTPinC">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/lgov">Lieven Govaerts</a></p>


      </header>
      <section>
        <h1>
<a name="mockhttpinc" class="anchor" href="#mockhttpinc"><span class="octicon octicon-link"></span></a>MockHTTPinC</h1>

<p>MockHTTPinC is a C library that helps testing HTTP client code.</p>

<p>The library provides:</p>

<ul>
<li>a HTTP server that can be instructed to handle requests in certain ways: returning a prebaked response, abort the connection etc.</li>
<li>support for both HTTP/1.0 and HTTP/1.1 including pipelining and chunked encoding</li>
<li>macro's to make writing expectations and verifying the results straigthforward</li>
</ul><p>The library will provide (but does not at this time):</p>

<ul>
<li>strong HTTPS support: full SSL/TLS handshake, client certificates, session renegotiation and session resumption</li>
<li>a simple HTTP/HTTPS proxy</li>
<li>Basic and Digest authentication</li>
<li>Deflate/GZip content encoding support</li>
</ul><p>MockHTTPinC does not come with or mandate the use of a specific unit test framework. Instead it should integrate fine with the unit test framework your project is currently using.</p>

<h2>
<a name="getting-started" class="anchor" href="#getting-started"><span class="octicon octicon-link"></span></a>Getting started</h2>

<p>Include these 4 source files in your project:</p>

<ul>
<li>MockHTTP.c</li>
<li>MockHTTP.h</li>
<li>MockHTTP_private.h</li>
<li>MockHTTP_server.c</li>
</ul><p>MockHTTPinC depends on these libraries:</p>

<ul>
<li>Apache's apr and apr-util libraries. (<a href="http://apr.apache.org">http://apr.apache.org</a>)</li>
<li>OpenSSL (<a href="http://www.openssl.org">http://www.openssl.org</a>)</li>
</ul><p>At this time the code conforms to the C99 standard. The code has been written with C89 in mind, but we use variadic macros (a C99 feature) to facilitate test writing.</p>

<h2>
<a name="write-a-first-test" class="anchor" href="#write-a-first-test"><span class="octicon octicon-link"></span></a>Write a first test</h2>

<p>In these examples we will use the CuTest framework (<a href="https://github.com/asimjalis/cutest">https://github.com/asimjalis/cutest</a>) as unit testing library, you'll recognize its functions by the <em>Cu</em> prefix.</p>

<p><strong>Step 1</strong>: Include MockHTTPinC's main header file, create a test function and setup the mock HTTP server on default port 30080.</p>

<pre><code>#include "MockHTTP.h"

static void test_simple_request_response(CuTest *tc)
{
  MockHTTP *mh;

  InitMockHTTP(mh)
    WithHTTPserver(WithPort(30080))
  EndInit
</code></pre>

<p><strong>Step 2</strong>: Use the macro's to instruct the mock HTTP server to expect a GET request to url /index.html. Also, tell the server how to respond when that request arrives.</p>

<pre><code>    Given(mh)
      GETRequest(
        URLEqualTo("/index.html"))
      Respond(
        WithCode(200), WithHeader("Connection", "Close"), WithBody("body"))
    EndGiven
</code></pre>

<p><strong>Step 3</strong>: Run the code that's expected to eventually send a GET request to the server.</p>

<pre><code>    ctx = connectToTCPServer("http://localhost:30080");
    sendRequest(ctx, "GET", "/index.html", headers, "body of the request");
    response = readResponse(ctx);

    // ... test that the response was received correctly
</code></pre>

<p><strong>Step 4</strong>: Use the macro's to verify that all requests were received in the correct order, at least the one request in this simple example.</p>

<pre><code>    Verify(mh)
      CuAssert(tc, ErrorMessage, VerifyAllRequestsReceivedInOrder);
    EndVerify
}
</code></pre>
      </section>
      <footer>
        <p><small>Hosted on <a href="http://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
